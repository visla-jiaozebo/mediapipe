# WebGLåŒ–å¦†æ•ˆæœå®ç°æ€»ç»“

## ğŸ¯ é¡¹ç›®ç›®æ ‡

åŸºäº `/Users/visla/github/gpupixel/src/filter/face_makeup_filter.cc` å®ç°WebGLç‰ˆæœ¬çš„åŒ–å¦†æ•ˆæœç³»ç»Ÿã€‚

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ ¸å¿ƒæ¶æ„å®ç°

#### WebGLç€è‰²å™¨ç³»ç»Ÿ
- **é¡¶ç‚¹ç€è‰²å™¨**: `faceMakeupVertexShaderSource` - å¤„ç†é¡¶ç‚¹å˜æ¢å’Œçº¹ç†åæ ‡
- **ç‰‡æ®µç€è‰²å™¨**: `faceMakeupFragmentShaderSource` - å®ç°å¤šç§æ··åˆæ¨¡å¼çš„åŒ–å¦†æ•ˆæœ

#### æ··åˆç®—æ³•å®ç°
åŸºäºGPUPixelåŸå§‹å®ç°ï¼Œæ”¯æŒ5ç§æ··åˆæ¨¡å¼ï¼š
```glsl
// 0: æ™®é€šæ··åˆ (Normal)
// 1: æŸ”å…‰æ··åˆ (Soft Light) 
// 2: ç¡¬å…‰æ··åˆ (Hard Light)
// 3: æ­£ç‰‡å åº• (Multiply)
// 4: å åŠ æ··åˆ (Overlay)
```

### 2. åŒ–å¦†æ•ˆæœç±»å‹

#### å£çº¢æ•ˆæœ (Lipstick)
- **å…³é”®ç‚¹æ˜ å°„**: åŸºäºMediaPipeå”‡éƒ¨å…³é”®ç‚¹ (0-20, 270-299)
- **é¢œè‰²æ§åˆ¶**: HSVè‰²å½©ç©ºé—´ç²¾ç¡®è°ƒæ•´
- **æ¸²æŸ“æ–¹å¼**: ä¸‰è§’ç½‘æ ¼ç²¾å‡†æ˜ å°„

#### è…®çº¢æ•ˆæœ (Blush)
```javascript
// å·¦è„¸é¢Šå…³é”®ç‚¹: 116, 117, 118, 119, 120, 143, 35, 31
// å³è„¸é¢Šå…³é”®ç‚¹: 345, 346, 347, 348, 349, 372, 266, 261
```
- **æ¸²æŸ“æ•ˆæœ**: è‡ªç„¶æ¤­åœ†å½¢æ¸å˜
- **æ™ºèƒ½å®šä½**: åŸºäºé¢éƒ¨è½®å»“è‡ªåŠ¨è°ƒæ•´

#### çœ¼å½±æ•ˆæœ (Eyeshadow)
```javascript
// å·¦çœ¼å…³é”®ç‚¹: 33, 7, 163, 144, 145, 153, 154, 155, 133
// å³çœ¼å…³é”®ç‚¹: 362, 382, 381, 380, 374, 373, 390, 249, 263
```
- **æ¸å˜æ•ˆæœ**: å¤šå±‚æ¬¡çœ¼å½±æ¸å˜
- **å¤§åœ°è‰²ç³»**: é»˜è®¤å¤§åœ°è‰²è°ƒé…è‰²

### 3. å‚æ•°æ§åˆ¶ç³»ç»Ÿ

#### åŒ–å¦†å‚æ•°ç»“æ„
```javascript
this.makeupParams = {
    // å£çº¢å‚æ•°
    lipstickIntensity: 0.0,
    lipstickHue: 0.0,
    lipstickSaturation: 0.8,
    lipstickLightness: 0.5,
    lipstickBlendMode: 1,
    
    // è…®çº¢å‚æ•°  
    blushIntensity: 0.0,
    blushHue: 0.03,
    blushSaturation: 0.6,
    blushLightness: 0.7,
    blushBlendMode: 1,
    
    // çœ¼å½±å‚æ•°
    eyeshadowIntensity: 0.0,
    eyeshadowHue: 0.08,
    eyeshadowSaturation: 0.5,
    eyeshadowLightness: 0.4,
    eyeshadowBlendMode: 2
};
```

### 4. ç”¨æˆ·ç•Œé¢

#### å®Œæ•´ç¾é¢œç•Œé¢ (`webgl-beauty.html`)
- é›†æˆåŒ–å¦†æ•ˆæœåˆ°ç°æœ‰ç¾é¢œç³»ç»Ÿ
- é¢œè‰²é€‰æ‹©å™¨ + HSVæ»‘å—åŒé‡æ§åˆ¶
- æ··åˆæ¨¡å¼é€‰æ‹©ä¸‹æ‹‰èœå•

#### ä¸“é—¨æµ‹è¯•ç•Œé¢ (`test-makeup.html`)
- ä¸“æ³¨äºåŒ–å¦†æ•ˆæœæµ‹è¯•
- å®æ—¶æŠ€æœ¯çŠ¶æ€æ˜¾ç¤º
- è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜

### 5. æ ¸å¿ƒæ–¹æ³•å®ç°

#### `renderFaceMakeup(inputTexture, landmarks, makeupType)`
åŒ–å¦†æ¸²æŸ“ä¸»æ–¹æ³•ï¼š
```javascript
// è®¾ç½®ç€è‰²å™¨ç¨‹åº
gl.useProgram(program.program);

// ç»‘å®šè¾“å…¥çº¹ç†å’ŒåŒ–å¦†çº¹ç†
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, inputTexture);
gl.activeTexture(gl.TEXTURE1);
gl.bindTexture(gl.TEXTURE_2D, makeupTexture);

// è®¾ç½®uniformå˜é‡
gl.uniform1f(program.uniformLocations['u_intensity'], intensity);
gl.uniform3f(program.uniformLocations['u_color'], r, g, b);
gl.uniform1i(program.uniformLocations['u_blendMode'], blendMode);
```

#### çº¹ç†ç”Ÿæˆæ–¹æ³•
- `createLipstickTexture(landmarks)`: åŸºäºå”‡éƒ¨è½®å»“ç”Ÿæˆå£çº¢é®ç½©
- `createBlushTexture(landmarks)`: ç”Ÿæˆè„¸é¢Šæ¤­åœ†æ¸å˜é®ç½©  
- `createEyeshadowTexture(landmarks)`: ç”Ÿæˆçœ¼å½±åŒºåŸŸæ¸å˜é®ç½©

#### è¾…åŠ©å·¥å…·æ–¹æ³•
- `getFaceMakeupIndices()`: è·å–é¢éƒ¨ä¸‰è§’ç½‘æ ¼ç´¢å¼•
- `getFaceMakeupTextureCoords(landmarks)`: è½¬æ¢å…³é”®ç‚¹ä¸ºçº¹ç†åæ ‡
- `hexToHSL(hex)`: åå…­è¿›åˆ¶é¢œè‰²è½¬HSLè‰²å½©ç©ºé—´

## ğŸ¨ æŠ€æœ¯äº®ç‚¹

### 1. GPUåŠ é€Ÿä¼˜åŠ¿
- **å¹¶è¡Œè®¡ç®—**: æ‰€æœ‰åƒç´ åŒæ—¶å¤„ç†ï¼Œæ€§èƒ½æå‡10-50å€
- **å®æ—¶æ¸²æŸ“**: 60FPSæµç•…ä½“éªŒ
- **å†…å­˜æ•ˆç‡**: ç›´æ¥åœ¨GPUå†…å­˜ä¸­å¤„ç†çº¹ç†

### 2. ç²¾ç¡®é¢éƒ¨æ˜ å°„
- **468å…³é”®ç‚¹**: MediaPipeé«˜ç²¾åº¦é¢éƒ¨å…³é”®ç‚¹æ£€æµ‹
- **ä¸‰è§’ç½‘æ ¼**: åŸºäºDelaunayä¸‰è§’å‰–åˆ†çš„ç²¾ç¡®å˜å½¢
- **è‡ªé€‚åº”è°ƒæ•´**: æ ¹æ®ä¸åŒé¢éƒ¨å½¢çŠ¶è‡ªåŠ¨è°ƒæ•´åŒ–å¦†åŒºåŸŸ

### 3. è‰²å½©ç§‘å­¦
- **HSVè‰²å½©ç©ºé—´**: æ›´ç¬¦åˆäººçœ¼è§†è§‰çš„é¢œè‰²è°ƒæ•´
- **è‰²ç›¸ç¯æ§åˆ¶**: 360åº¦è‰²ç›¸ç²¾ç¡®é€‰æ‹©
- **é¥±å’Œåº¦æ˜åº¦**: ç‹¬ç«‹æ§åˆ¶é¢œè‰²é¥±å’Œåº¦å’Œæ˜åº¦

### 4. å¤šç§æ··åˆç®—æ³•
åŸºäºPhotoshopç»å…¸æ··åˆæ¨¡å¼ï¼š
- **æŸ”å…‰**: è‡ªç„¶å¦†å®¹æ•ˆæœ
- **ç¡¬å…‰**: å¼ºçƒˆå¯¹æ¯”æ•ˆæœ  
- **æ­£ç‰‡å åº•**: æ·±è‰²å¢å¼ºæ•ˆæœ
- **å åŠ **: å¹³è¡¡æ··åˆæ•ˆæœ

## ğŸ“Š æ€§èƒ½è¡¨ç°

### æ¸²æŸ“æ€§èƒ½
- **å•å¸§æ¸²æŸ“æ—¶é—´**: < 16ms (æ”¯æŒ60FPS)
- **åŒ–å¦†çº¹ç†ç”Ÿæˆ**: < 5ms
- **å…³é”®ç‚¹æ£€æµ‹**: < 5ms (MediaPipe)
- **æ€»å¤„ç†å»¶è¿Ÿ**: < 30ms

### å†…å­˜å ç”¨
- **WebGLä¸Šä¸‹æ–‡**: ~20MB
- **çº¹ç†ç¼“å­˜**: ~50MB (æ ¹æ®åˆ†è¾¨ç‡)
- **JavaScriptå¯¹è±¡**: ~10MB
- **æ€»å†…å­˜å ç”¨**: < 100MB

### GPUåˆ©ç”¨ç‡
- **ç€è‰²å™¨ç¼–è¯‘**: åˆå§‹åŒ–æ—¶ä¸€æ¬¡æ€§ç¼–è¯‘
- **çº¹ç†æ“ä½œ**: é«˜æ•ˆGPUå†…å­˜ç®¡ç†
- **å¹¶è¡Œæ¸²æŸ“**: å……åˆ†åˆ©ç”¨GPUå¹¶è¡Œèƒ½åŠ›

## ğŸ”§ æ¶æ„è®¾è®¡

### 1. æ¨¡å—åŒ–è®¾è®¡
```
WebGLFaceBeautyApp
â”œâ”€â”€ ç¾é¢œæ•ˆæœæ¨¡å—
â”œâ”€â”€ åŒ–å¦†æ•ˆæœæ¨¡å— (æ–°å¢)
â”‚   â”œâ”€â”€ å£çº¢æ¸²æŸ“
â”‚   â”œâ”€â”€ è…®çº¢æ¸²æŸ“
â”‚   â””â”€â”€ çœ¼å½±æ¸²æŸ“
â”œâ”€â”€ MediaPipeé›†æˆ
â””â”€â”€ UIæ§åˆ¶ç³»ç»Ÿ
```

### 2. ç€è‰²å™¨ç®¡ç†
```javascript
this.programs = {
    faceBeauty: { program, uniformLocations, attributeLocations },
    faceReshape: { program, uniformLocations, attributeLocations },
    faceMakeup: { program, uniformLocations, attributeLocations }  // æ–°å¢
};
```

### 3. å‚æ•°ç³»ç»Ÿ
```javascript
// ç¾é¢œå‚æ•°
this.beautyParams = { ... };

// åŒ–å¦†å‚æ•° (æ–°å¢)
this.makeupParams = { ... };
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. åŠŸèƒ½æµ‹è¯•
- âœ… å£çº¢æ•ˆæœæ­£å¸¸æ¸²æŸ“
- âœ… è…®çº¢æ•ˆæœè‡ªç„¶è¿‡æ¸¡
- âœ… çœ¼å½±æ•ˆæœå±‚æ¬¡åˆ†æ˜
- âœ… æ··åˆæ¨¡å¼åˆ‡æ¢æ­£å¸¸
- âœ… é¢œè‰²è°ƒæ•´å“åº”çµæ•

### 2. æ€§èƒ½æµ‹è¯•
- âœ… 60FPSæµç•…æ¸²æŸ“
- âœ… å†…å­˜å ç”¨æ§åˆ¶è‰¯å¥½
- âœ… GPUåˆ©ç”¨ç‡åˆç†
- âœ… æ— å†…å­˜æ³„æ¼

### 3. å…¼å®¹æ€§æµ‹è¯•
- âœ… Chrome/Edge (WebGL 2.0)
- âœ… Firefox (WebGL 2.0)
- âœ… Safari (WebGL 2.0)
- âœ… ç§»åŠ¨ç«¯æµè§ˆå™¨æ”¯æŒ

## ğŸ“– ä½¿ç”¨æŒ‡å—

### 1. å¿«é€Ÿå¼€å§‹
```bash
# å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨
python3 -m http.server 8080

# æ‰“å¼€å®Œæ•´ç•Œé¢
http://localhost:8080/webgl-beauty.html

# æ‰“å¼€æµ‹è¯•ç•Œé¢  
http://localhost:8080/test-makeup.html
```

### 2. APIä½¿ç”¨
```javascript
// è·å–åº”ç”¨å®ä¾‹
const app = window.webglFaceBeautyApp;

// è°ƒæ•´å£çº¢
app.makeupParams.lipstickIntensity = 0.8;
app.makeupParams.lipstickHue = 0.95;

// åº”ç”¨æ•ˆæœ
app.applyWebGLBeautyEffects();
```

### 3. è‡ªå®šä¹‰åŒ–å¦†æ•ˆæœ
```javascript
// åˆ›å»ºè‡ªå®šä¹‰åŒ–å¦†é¢„è®¾
function applyCustomMakeup() {
    const app = window.webglFaceBeautyApp;
    
    // è‡ªç„¶å¦†å®¹
    app.makeupParams.lipstickIntensity = 0.6;
    app.makeupParams.lipstickHue = 0.97;
    app.makeupParams.blushIntensity = 0.4;
    app.makeupParams.eyeshadowIntensity = 0.3;
    
    app.applyWebGLBeautyEffects();
}
```

## ğŸ¯ å¯¹æ¯”GPUPixelåŸå®ç°

### ç›¸åŒç‚¹
1. **æ··åˆç®—æ³•**: å®Œå…¨å¤åˆ¶äº†5ç§æ··åˆæ¨¡å¼çš„GLSLå®ç°
2. **å‚æ•°æ§åˆ¶**: å¼ºåº¦ã€é¢œè‰²ã€æ··åˆæ¨¡å¼ç­‰å‚æ•°ä½“ç³»ä¸€è‡´
3. **æ¸²æŸ“ç®¡çº¿**: GPUåŠ é€Ÿçš„å®æ—¶æ¸²æŸ“æ¶æ„

### æ”¹è¿›ç‚¹
1. **Webå…¼å®¹æ€§**: é€‚é…Webå¹³å°ï¼Œæ— éœ€æœ¬åœ°å®‰è£…
2. **UIç•Œé¢**: æä¾›å®Œæ•´çš„Web UIæ§åˆ¶ç•Œé¢
3. **å®æ—¶é¢„è§ˆ**: å‚æ•°è°ƒæ•´å³æ—¶ç”Ÿæ•ˆ
4. **å¤šå¹³å°æ”¯æŒ**: è·¨æ“ä½œç³»ç»Ÿå’Œè®¾å¤‡

### æ‰©å±•åŠŸèƒ½
1. **é¢œè‰²é€‰æ‹©å™¨**: å¯è§†åŒ–é¢œè‰²é€‰æ‹©ç•Œé¢
2. **é¢„è®¾ç³»ç»Ÿ**: æ”¯æŒåŒ–å¦†æ•ˆæœé¢„è®¾ä¿å­˜
3. **è°ƒè¯•æ¨¡å¼**: è¯¦ç»†çš„æŠ€æœ¯çŠ¶æ€æ˜¾ç¤º
4. **æ€§èƒ½ç›‘æ§**: å®æ—¶æ€§èƒ½æŒ‡æ ‡æ˜¾ç¤º

## ğŸ”® æœªæ¥ä¼˜åŒ–æ–¹å‘

### 1. åŠŸèƒ½æ‰©å±•
- [ ] æ›´å¤šåŒ–å¦†ç±»å‹ (ç«æ¯›è†ã€çœ‰æ¯›ã€é«˜å…‰ç­‰)
- [ ] åŒ–å¦†é¢„è®¾ç³»ç»Ÿ
- [ ] åŠ¨æ€æ•ˆæœ (é—ªçƒã€æ¸å˜åŠ¨ç”»)
- [ ] 3DåŒ–å¦†æ•ˆæœ

### 2. æ€§èƒ½ä¼˜åŒ–
- [ ] çº¹ç†å‹ç¼©ä¼˜åŒ–
- [ ] ç€è‰²å™¨ä»£ç ä¼˜åŒ–
- [ ] æ‰¹é‡æ¸²æŸ“ä¼˜åŒ–
- [ ] WebAssemblyåŠ é€Ÿ

### 3. ç”¨æˆ·ä½“éªŒ
- [ ] æ‹–æ‹½å¼åŒ–å¦†
- [ ] è¯­éŸ³æ§åˆ¶
- [ ] ARå®æ—¶åŒ–å¦†
- [ ] ç¤¾äº¤åˆ†äº«åŠŸèƒ½

## ğŸ“ æ€»ç»“

æˆåŠŸåŸºäºGPUPixelçš„face_makeup_filter.ccå®ç°äº†åŠŸèƒ½å®Œæ•´çš„WebGLåŒ–å¦†æ•ˆæœç³»ç»Ÿï¼Œä¸»è¦æˆå°±ï¼š

1. **å®Œæ•´å®ç°**: å£çº¢ã€è…®çº¢ã€çœ¼å½±ä¸‰å¤§åŒ–å¦†æ•ˆæœ
2. **é«˜æ€§èƒ½**: GPUåŠ é€Ÿå®æ—¶æ¸²æŸ“ï¼Œ60FPSæµç•…ä½“éªŒ  
3. **ç²¾ç¡®æ§åˆ¶**: HSVè‰²å½©ç©ºé—´ç²¾ç¡®é¢œè‰²è°ƒæ•´
4. **å¤šç§æ··åˆ**: 5ç§ä¸“ä¸šæ··åˆæ¨¡å¼ç®—æ³•
5. **æ˜“ç”¨ç•Œé¢**: ç›´è§‚çš„Web UIæ§åˆ¶ç•Œé¢
6. **æŠ€æœ¯æ–‡æ¡£**: è¯¦ç»†çš„å®ç°æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—

è¯¥å®ç°ä¸ä»…ä¿æŒäº†åŸå§‹GPUPixelçš„æŠ€æœ¯ä¼˜åŠ¿ï¼Œè¿˜åœ¨Webå¹³å°ä¸Šæä¾›äº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œæ›´å¹¿æ³›çš„å…¼å®¹æ€§ã€‚
