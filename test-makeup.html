<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGLåŒ–å¦†æ•ˆæœæµ‹è¯•</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .makeup-test {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .test-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .feature-info {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .canvas-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .canvas-box {
            text-align: center;
        }
        
        .canvas-box canvas {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            max-width: 100%;
            height: auto;
        }
        
        .status-display {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¨ WebGLåŒ–å¦†æ•ˆæœæµ‹è¯•</h1>
            <p>åŸºäºGPUPixelçš„WebGLåŒ–å¦†ç³»ç»Ÿå®ç°</p>
        </header>

        <div class="makeup-test">
            <!-- åŠŸèƒ½è¯´æ˜ -->
            <div class="feature-info">
                <h3>âœ¨ WebGLåŒ–å¦†ç³»ç»Ÿç‰¹æ€§</h3>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>ğŸ¯ åŸºäºMediaPipeé¢éƒ¨å…³é”®ç‚¹çš„ç²¾å‡†å®šä½</li>
                    <li>ğŸ¨ æ”¯æŒå£çº¢ã€è…®çº¢ã€çœ¼å½±ä¸‰ç§åŒ–å¦†æ•ˆæœ</li>  
                    <li>ğŸŒˆ å¤šç§æ··åˆæ¨¡å¼ï¼šæŸ”å…‰ã€ç¡¬å…‰ã€æ­£ç‰‡å åº•ã€å åŠ </li>
                    <li>âš¡ GPUåŠ é€Ÿå®æ—¶æ¸²æŸ“ï¼Œæµç•…ä½“éªŒ</li>
                    <li>ğŸ›ï¸ HSVè‰²å½©ç©ºé—´ç²¾ç¡®é¢œè‰²æ§åˆ¶</li>
                </ul>
            </div>

            <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
            <div class="test-section">
                <h3>ğŸ“¸ å›¾ç‰‡ä¸Šä¼ </h3>
                <div class="upload-area" id="uploadArea">
                    <input type="file" id="imageInput" accept="image/*" style="display: none;">
                    <div class="upload-content">
                        <div class="upload-icon">ğŸ–¼ï¸</div>
                        <p>ç‚¹å‡»ä¸Šä¼ æµ‹è¯•å›¾ç‰‡</p>
                        <small>å»ºè®®ä½¿ç”¨æ¸…æ™°çš„æ­£é¢äººè„¸ç…§ç‰‡</small>
                    </div>
                </div>
            </div>

            <!-- çŠ¶æ€æ˜¾ç¤º -->
            <div class="status-display" id="statusDisplay">
                <strong>çŠ¶æ€:</strong> ç­‰å¾…ä¸Šä¼ å›¾ç‰‡...
            </div>

            <!-- ç”»å¸ƒæ˜¾ç¤ºåŒºåŸŸ -->
            <div class="canvas-container">
                <div class="canvas-box">
                    <h4>åŸå§‹å›¾åƒ</h4>
                    <canvas id="originalCanvas" width="300" height="400"></canvas>
                </div>
                <div class="canvas-box">
                    <h4>åŒ–å¦†æ•ˆæœ</h4>
                    <canvas id="resultCanvas" width="300" height="400"></canvas>
                </div>
            </div>

            <!-- åŒ–å¦†æ§åˆ¶é¢æ¿ -->
            <div class="test-section">
                <h3>ğŸ’„ åŒ–å¦†æ•ˆæœæ§åˆ¶</h3>
                <div class="test-controls">
                    <!-- å£çº¢æ§åˆ¶ -->
                    <div class="control-group">
                        <h4>ğŸ’‹ å£çº¢æ•ˆæœ</h4>
                        <label>å¼ºåº¦: <input type="range" id="lipstickIntensity" min="0" max="100" value="0">
                            <span id="lipstickIntensityValue">0</span>%</label>
                        <label>é¢œè‰²: <input type="color" id="lipstickColor" value="#ff6b6b"></label>
                        <label>è‰²ç›¸: <input type="range" id="lipstickColorHue" min="0" max="360" value="355">
                            <span id="lipstickColorHueValue">355</span>Â°</label>
                    </div>

                    <!-- è…®çº¢æ§åˆ¶ -->
                    <div class="control-group">
                        <h4>ğŸŒ¸ è…®çº¢æ•ˆæœ</h4>
                        <label>å¼ºåº¦: <input type="range" id="blushIntensity" min="0" max="100" value="0">
                            <span id="blushIntensityValue">0</span>%</label>
                        <label>é¢œè‰²: <input type="color" id="blushColor" value="#ff9999"></label>
                        <label>è‰²ç›¸: <input type="range" id="blushColorHue" min="0" max="360" value="10">
                            <span id="blushColorHueValue">10</span>Â°</label>
                    </div>

                    <!-- çœ¼å½±æ§åˆ¶ -->
                    <div class="control-group">
                        <h4>ğŸ‘ï¸ çœ¼å½±æ•ˆæœ</h4>
                        <label>å¼ºåº¦: <input type="range" id="eyeshadowIntensity" min="0" max="100" value="0">
                            <span id="eyeshadowIntensityValue">0</span>%</label>
                        <label>é¢œè‰²: <input type="color" id="eyeshadowColor" value="#d4a574"></label>
                        <label>è‰²ç›¸: <input type="range" id="eyeshadowColorHue" min="0" max="360" value="30">
                            <span id="eyeshadowColorHueValue">30</span>Â°</label>
                    </div>

                    <!-- å…¨å±€æ§åˆ¶ -->
                    <div class="control-group">
                        <h4>âš™ï¸ å…¨å±€è®¾ç½®</h4>
                        <label>æ··åˆæ¨¡å¼:
                            <select id="makeupBlendMode">
                                <option value="0">æ™®é€šæ··åˆ</option>
                                <option value="1">æŸ”å…‰æ··åˆ</option>
                                <option value="2">ç¡¬å…‰æ··åˆ</option>
                                <option value="3">æ­£ç‰‡å åº•</option>
                                <option value="4">å åŠ æ··åˆ</option>
                            </select>
                        </label>
                        <button id="resetMakeup" class="btn btn-secondary">é‡ç½®åŒ–å¦†</button>
                        <button id="downloadResult" class="btn btn-primary">ä¸‹è½½ç»“æœ</button>
                    </div>
                </div>
            </div>

            <!-- æŠ€æœ¯ä¿¡æ¯ -->
            <div class="test-section">
                <h3>ğŸ”§ æŠ€æœ¯å®ç°è¯¦æƒ…</h3>
                <div id="techInfo">
                    <p><strong>WebGLä¸Šä¸‹æ–‡:</strong> <span id="webglStatus">æœªåˆå§‹åŒ–</span></p>
                    <p><strong>ç€è‰²å™¨ç¨‹åº:</strong> <span id="shaderStatus">æœªç¼–è¯‘</span></p>
                    <p><strong>é¢éƒ¨å…³é”®ç‚¹:</strong> <span id="landmarkStatus">æœªæ£€æµ‹</span></p>
                    <p><strong>åŒ–å¦†çº¹ç†:</strong> <span id="textureStatus">æœªåˆ›å»º</span></p>
                    <p><strong>æ¸²æŸ“æ—¶é—´:</strong> <span id="renderTime">0ms</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- åŠ è½½ä¾èµ– -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
    
    <!-- ä¸»è¦è„šæœ¬ -->
    <script src="webgl-face-beauty.js"></script>
    
    <script>
        // æµ‹è¯•é¡µé¢ç‰¹å®šçš„åˆå§‹åŒ–å’Œæ§åˆ¶é€»è¾‘
        document.addEventListener('DOMContentLoaded', () => {
            console.log('åŒ–å¦†æ•ˆæœæµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            
            // çŠ¶æ€æ›´æ–°å‡½æ•°
            function updateStatus(message) {
                document.getElementById('statusDisplay').innerHTML = `<strong>çŠ¶æ€:</strong> ${message}`;
            }
            
            // æŠ€æœ¯ä¿¡æ¯æ›´æ–°
            function updateTechInfo(info) {
                Object.keys(info).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.textContent = info[key];
                    }
                });
            }
            
            // é‡ç½®åŒ–å¦†æ•ˆæœ
            document.getElementById('resetMakeup').addEventListener('click', () => {
                const controls = ['lipstickIntensity', 'blushIntensity', 'eyeshadowIntensity'];
                controls.forEach(id => {
                    const slider = document.getElementById(id);
                    if (slider) {
                        slider.value = 0;
                        slider.dispatchEvent(new Event('input'));
                    }
                });
                updateStatus('åŒ–å¦†æ•ˆæœå·²é‡ç½®');
            });
            
            // ä¸‹è½½ç»“æœ
            document.getElementById('downloadResult').addEventListener('click', () => {
                const canvas = document.getElementById('resultCanvas');
                if (canvas) {
                    const link = document.createElement('a');
                    link.download = 'makeup-result.png';
                    link.href = canvas.toDataURL();
                    link.click();
                    updateStatus('ç»“æœå›¾ç‰‡å·²ä¸‹è½½');
                }
            });
            
            // ç›‘å¬WebGLåº”ç”¨åˆå§‹åŒ–
            if (window.webglFaceBeautyApp) {
                updateTechInfo({
                    webglStatus: 'å·²åˆå§‹åŒ–',
                    shaderStatus: 'ç¼–è¯‘å®Œæˆ'
                });
                updateStatus('WebGLåŒ–å¦†ç³»ç»Ÿå‡†å¤‡å°±ç»ª');
            }
        });
    </script>
</body>
</html>
