<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGL基本测试</title>
</head>
<body>
    <h1>WebGL基本渲染测试</h1>
    <div id="result"></div>
    <canvas id="canvas" width="512" height="512"></canvas>

    <script>
        async function testBasicWebGL() {
            const resultDiv = document.getElementById('result');
            const canvas = document.getElementById('canvas');
            
            try {
                // 测试WebGL基本功能
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (!gl) {
                    throw new Error('WebGL不支持');
                }
                
                // 简单的vertex shader
                const vertexShaderSource = `
                    attribute vec2 a_position;
                    attribute vec2 a_texCoord;
                    varying vec2 v_texCoord;
                    void main() {
                        gl_Position = vec4(a_position, 0.0, 1.0);
                        v_texCoord = a_texCoord;
                    }
                `;
                
                // 简单的fragment shader（纯色）
                const fragmentShaderSource = `
                    precision mediump float;
                    varying vec2 v_texCoord;
                    void main() {
                        gl_FragColor = vec4(v_texCoord.x, v_texCoord.y, 0.5, 1.0);
                    }
                `;
                
                // 编译shader
                const vertexShader = gl.createShader(gl.VERTEX_SHADER);
                gl.shaderSource(vertexShader, vertexShaderSource);
                gl.compileShader(vertexShader);
                
                const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
                gl.shaderSource(fragmentShader, fragmentShaderSource);
                gl.compileShader(fragmentShader);
                
                // 创建程序
                const program = gl.createProgram();
                gl.attachShader(program, vertexShader);
                gl.attachShader(program, fragmentShader);
                gl.linkProgram(program);
                
                if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
                    throw new Error('程序链接失败');
                }
                
                // 创建几何体
                const vertices = new Float32Array([
                    -1.0, -1.0,  0.0, 0.0,
                     1.0, -1.0,  1.0, 0.0,
                    -1.0,  1.0,  0.0, 1.0,
                     1.0,  1.0,  1.0, 1.0,
                ]);
                
                const indices = new Uint16Array([0, 1, 2, 1, 3, 2]);
                
                // 创建缓冲区
                const vertexBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
                gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
                
                const indexBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);
                gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW);
                
                // 设置渲染
                gl.viewport(0, 0, canvas.width, canvas.height);
                gl.clearColor(0.0, 0.0, 0.0, 1.0);
                gl.clear(gl.COLOR_BUFFER_BIT);
                
                gl.useProgram(program);
                
                // 获取属性位置
                const positionLocation = gl.getAttribLocation(program, 'a_position');
                const texCoordLocation = gl.getAttribLocation(program, 'a_texCoord');
                
                // 设置属性
                gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
                gl.enableVertexAttribArray(positionLocation);
                gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 16, 0);
                
                gl.enableVertexAttribArray(texCoordLocation);
                gl.vertexAttribPointer(texCoordLocation, 2, gl.FLOAT, false, 16, 8);
                
                // 渲染
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);
                gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);
                
                resultDiv.innerHTML = '<p style="color: green;">✅ WebGL基本渲染测试成功！应该看到一个彩色渐变四边形</p>';
                
            } catch (error) {
                console.error('WebGL测试失败:', error);
                resultDiv.innerHTML = `<p style="color: red;">❌ WebGL测试失败: ${error.message}</p>`;
            }
        }
        
        document.addEventListener('DOMContentLoaded', testBasicWebGL);
    </script>
</body>
</html>
